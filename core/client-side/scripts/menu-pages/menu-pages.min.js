/*
 * Menu Pages Extension
 *
 * Copyright: © 2014 <pan.vagenas@gmail.com>
 *
 * @author Panagiotis Vagenas
 * @package XDaRk\Core
 * @since 141226
 */
(function(b){b(".documentation-btn").click(function(c){c.preventDefault()});var a=$xd_v141226_dev;if(a.___did_menu_pages){return}b.each(a.$.___plugin_root_namespaces,function(e,c){var f=a.$.extension_class(c,"menu_pages");window["$"+c].$menu_pages=new f();var d=window["$"+c].$menu_pages;d.toggling_all_panels=false;d.on_dom_ready=function(){var l=d.$menu_page();var i=d.$content_panels();var k=d.$sidebar_panels();var n=d.$content_sidebar_panels();b("#wpbody").addClass(d.closest_theme_class_to(l)).css({"margin-left":"-20px","padding-left":"20px","min-height":screen.height+"px"});l.find(".toggle-all-panels").on("click",function(){d.toggling_all_panels=true;var q=b(this),p=q.data("last-action");var o=p==="show"?"hide":"show";q.data("last-action",o),n.find("> .panel-collapse")[d.core("->collapse")]({toggle:false})[d.core("->collapse")](o);setTimeout(function(){d.toggling_all_panels=false,m(),h()},2000)});l.find(".update-theme ul > li").on("click",function(){l.find(".update-theme").find("input.selected-theme").val(b(this).data("theme")).closest("form").submit()});var m=function(){if(d.toggling_all_panels){return}var o=[],p=[];i.each(function(){var q=b(this);if(q.find("> .panel-collapse").hasClass("in")){o.push(q.data("panel-slug"))}else{p.push(q.data("panel-slug"))}});d.post("©menu_pages__"+d.is_plugin_menu_page("",true)+".®update_content_panels_state",d.___private_type,[o,p]);console.log("Updating content panels state.")};i.find("> .panel-collapse").on("shown."+d.core("-bs")+".collapse",m).on("hidden."+d.core("-bs")+".collapse",m);var h=function(){if(d.toggling_all_panels){return}var o=[],p=[];k.each(function(){var q=b(this);if(q.find("> .panel-collapse").hasClass("in")){o.push(q.data("panel-slug"))}else{p.push(q.data("panel-slug"))}});d.post("©menu_pages__"+d.is_plugin_menu_page("",true)+".®update_sidebar_panels_state",d.___private_type,[o,p]);console.log("Updating sidebar panels state.")};k.find("> .panel-collapse").on("shown."+d.core("-bs")+".collapse",h).on("hidden."+d.core("-bs")+".collapse",h);var g=function(){var o=[];l.find(".content-panels > .panel").each(function(){var p=b(this);o.push(p.data("panel-slug"))});d.post("©menu_pages__"+d.is_plugin_menu_page("",true)+".®update_content_panels_order",d.___private_type,[o]);console.log("Updating content panels order.")};l.find(".content-panels")[d.core("->sortable")]({items:".panel",handle:"> .panel-heading > .panel-title .cursor-move"});l.find(".content-panels").on("sortupdate",g);var j=function(){var o=[];l.find(".sidebar-panels > .panel").each(function(){var p=b(this);o.push(p.data("panel-slug"))});d.post("©menu_pages__"+d.is_plugin_menu_page("",true)+".®update_sidebar_panels_order",d.___private_type,[o]);console.log("Updating sidebar panels order.")};l.find(".sidebar-panels")[d.core("->sortable")]({items:".panel",handle:"> .panel-heading > .panel-title .cursor-move"});l.find(".sidebar-panels").on("sortupdate",j);l.find(".activate-lic").on("click",function(){var p=b("#license").val();var o=d.post("©edd_updater.®ajaxActivateLicense",d.___private_type,[p],{complete:function(q){location.reload()}})});l.find(".deactivate-lic").click(function(){var p=b("#license").val();var o=d.post("©edd_updater.®ajaxDeactivateLicense",d.___private_type,[p],{complete:function(q){location.reload()}})});l.find(".input-media-wrapper").each(function(){var o=b(this);var p=o.find(".media-input");o.find(".input-media-btn").click(function(){d.openFileFrame(p)})})};d.on_win_load=function(){var k=d.$menu_page();var i=d.get_query_var("content_panel_slug");var j=d.get_query_var("sidebar_panel_slug");var m,h;if(i&&(m=k.find(".content-panels #panel--"+i+".panel-collapse")).length){var l=function(){b[d.core("->scrollTo")](m.prev(".panel-heading"),{offset:{top:-100,left:0},duration:500})};if(m.hasClass("in")){l()}else{m.one("shown."+d.core("-bs")+".collapse",l),m[d.core("->collapse")]({toggle:false})[d.core("->collapse")]("show")}}if(j&&(h=k.find(".sidebar-panels #panel--"+j+".panel-collapse")).length){var g=function(){if(!i){b[d.core("->scrollTo")](h.prev(".panel-heading"),{offset:{top:-100,left:0},duration:500})}};if(h.hasClass("in")){g()}else{h.one("shown."+d.core("-bs")+".collapse",g),h[d.core("->collapse")]({toggle:false})[d.core("->collapse")]("show")}}};d.$menu_page=function(){if(d.cache.$menu_page){return d.cache.$menu_page}return(d.cache.$menu_page=b("."+d.instance("plugin_root_ns_with_dashes")+".menu-page"))};d.$content_panels=function(){if(d.cache.$content_panels){return d.cache.$content_panels}return(d.cache.$content_panels=d.$menu_page().find(".content-panels > .panel"))};d.$sidebar_panels=function(){if(d.cache.$sidebar_panels){return d.cache.$sidebar_panels}return(d.cache.$sidebar_panels=d.$menu_page().find(".sidebar-panels > .panel"))};d.$content_sidebar_panels=function(){if(d.cache.$content_sidebar_panels){return d.cache.$content_sidebar_panels}return(d.cache.$content_sidebar_panels=d.$menu_page().find(".content-panels > .panel, .sidebar-panels > .panel"))};d.openFileFrame=function(g){if(undefined===g.file_frame){g.file_frame=wp.media.frames.file_frame=wp.media({title:"Insert Media",button:{text:"Upload Image"},multiple:false})}else{g.file_frame.open();return}g.file_frame.on("select",function(){var h=g.file_frame.state().get("selection").first().toJSON();g.val(h.url)});g.file_frame.open();return true};b(document).on("ready",d.on_dom_ready),b(window).on("load",d.on_win_load)});a.___did_menu_pages=true})(jQuery);