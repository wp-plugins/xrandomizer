(function(d){var h=$xd_v141226_dev.$.extension_class("randomizer","$ajax");var a=window["$randomizer"].$menu_pages;$randomizer.$ajax=new h();$randomizer.$ajax.getElementMarkup=function(l,r,q,o,p,n,k,m){$randomizer.$ajax.get("©ajax.®ajaxPrivateGetElementMarkup",$randomizer.$ajax.___private_type,[l,r,q,o,p,n],{complete:k,beforeSend:m})};var j=function(k){this.setIdx=k;this.selector="#panel--random-set-"+this.setIdx};j.prototype={bindDeleteEvent:function(){d(".set-delete").unbind("click").click(function(){var l=confirm("Are you sure you want to delete this set?");if(l!=true){return l}var m=parseInt(d(this).attr("data-setidx"));var k=new j(m);k.deleteSet()})},bindAddEvent:function(){d(".set-add").unbind("click").click(function(){var l=parseInt(d(this).attr("data-setidx"));var k=new j(l);k.addNewSet()})},addNewSet:function(){j.prototype.bindAddEvent();j.prototype.bindDeleteEvent()},deleteSet:function(){d(this.selector).remove();j.prototype.bindAddEvent();j.prototype.bindDeleteEvent()}};var e=function(m,k){this.setIdx=m;this.idx=k;this.mode=null;var l=d(this.selector());if(l.length){this.pined=d(this.pinedSelector()).hasClass("active");this.disabled=d(this.disableSelector()).hasClass("active")}else{this.pined=false;this.disabled=false}this.init()};e.prototype={codeModes:{html:"HTML",php:"PHP",markdown:"Markdown",javascript:"Javascript",text:"Text"},init:function(){},selector:function(){return"#element-row-random-set-"+this.setIdx+"-"+this.idx},pinedSelector:function(){return this.selector()+" .element-pin"},disableSelector:function(){return this.selector()+" .element-disable"},elementAddSelector:function(){return this.selector()+" .element-add"},elementDeleteSelector:function(){return this.selector()+" .element-delete"},elementChangeModeSelector:function(){return this.selector()+" .element-change-method"},elementModeInputSelector:function(){return this.selector()+" .element-mode"},factory:function(n){var k=parseInt(n.attr("data-index"));var l=parseInt(n.attr("data-setid"));var m=n.attr("data-mode");switch(m){case"banner":return new g(l,k);case"post_category":return new i(l,k);case"post_type":return new c(l,k);default:return new f(l,k,m)}},getTheContent:function(){return""},getBaseInputName:function(){return"rz[a][a][0]["+this.setIdx+"][elements]["+this.idx+"]"},getContentInputName:function(){return this.getBaseInputName()+"[content]"},getPinedInputName:function(){return this.getBaseInputName()+"[pined]"},getDisabledInputName:function(){return this.getBaseInputName()+"[disabled]"},getModeInputName:function(){return this.getBaseInputName()+"[mode]"},append:function(l){var k=d(this.selector());$randomizer.$ajax.getElementMarkup(this.setIdx,this.idx+1,l,this.getTheContent(),false,false,function(m){var p=m.responseJSON;if(p.data.html!=undefined){var n=d(p.data.html);k.after(n[0].outerHTML);var o=e.prototype.factory(n);o.updateIndexes()}})},getNextElement:function(){var k=d(this.selector()).next(".form-group");if(k.length){return this.factory(k)}return false},updateInputNames:function(k){d(this.pinedSelector()).attr("name",this.getPinedInputName());d(this.disableSelector()).attr("name",this.getDisabledInputName());d(this.elementModeInputSelector()).attr("name",this.getModeInputName())},updateIndexes:function(){var k=this;d(this.selector()).parent().find(".form-group.element").each(function(m){var l=e.prototype.factory(d(this));l.unBindClickEvents();l.idx=m;d(this).attr("data-index",m);d(this).attr("id","element-row-random-set-"+l.setIdx+"-"+m);l.updateInputNames(d(this))});d(this.selector()).parent().find(".form-group.element").each(function(m){var l=e.prototype.factory(d(this));l.bindClickEvent()})},remove:function(){var k=this;d(this.selector()).slideUp("fast",function(){d(this).remove();k.updateIndexes()})},pin:function(){if(!this.pined){this.pined=true;var k=d(this.pinedSelector());k.addClass("active");k.val(1);k.children("i").removeClass("fa-unlock");k.children("i").addClass("fa-lock")}},unPin:function(){if(this.pined){this.pined=false;var k=d(this.pinedSelector());k.removeClass("active").blur();k.val(0);k.children("i").removeClass("fa-lock");k.children("i").addClass("fa-unlock")}},disable:function(){if(!this.disabled){this.disabled=true;var k=d(this.disableSelector());k.addClass("active").blur();k.val(1)}},activate:function(){if(this.disabled){this.disabled=false;var k=d(this.disableSelector());k.removeClass("active").blur();k.val(0)}},changeMode:function(k){},unBindClickEvents:function(){d(this.elementAddSelector()).next().find("li").unbind("click");d(this.elementAddSelector()).next().find("li").find("a").unbind("click");d(this.elementDeleteSelector()).unbind("click");d(this.pinedSelector()).unbind("click");d(this.disableSelector()).unbind("click")},bindClickEvent:function(){var k=this;d(this.elementAddSelector()).next().find("li").unbind("click").click(function(l){l.preventDefault();var m=d(this).attr("data-mode");k.append(m)});d(this.elementAddSelector()).next().find("li").find("a").unbind("click").click(function(l){l.preventDefault()});d(this.elementDeleteSelector()).unbind("click").click(function(){var l=confirm("Are you sure you want to delete this element?");if(l!=true){return l}k.remove()});d(this.pinedSelector()).unbind("click").click(function(){if(d(this).hasClass("active")){k.unPin()}else{k.pin()}});d(this.disableSelector()).unbind("click").click(function(){if(d(this).hasClass("active")){k.activate()}else{k.disable()}})}};var b=function(l,k){e.apply(this,arguments);this.markUp='<ul data-index="{{idx}}"data-set="{{slug}}"data-setid="{{setIdx}}"class="dropdown-menu"><li data-mode="html"><a href="#">HTML</a></li><li data-mode="php"><a href="#">PHP</a></li><li data-mode="markdown"><a href="#">Markdown</a></li><li data-mode="javascript"><a href="#">Javascript</a></li><li data-mode="text"><a href="#">Text</a></li><li data-mode="banner"><a href="#">Banner</a></li></ul>'};var f=function(m,k,l){e.apply(this,arguments);this.mode=(l==undefined||l==null||e.prototype.codeModes[l]==undefined)?"html":l;this.bindEditor()};f.prototype=Object.create(e.prototype);f.prototype.constructor=f;f.prototype.textAreaSelector=function(){return this.selector()+" .element-text-area"};f.prototype.updateIndexes=function(){e.prototype.updateIndexes.call(this);this.bindEditor()};f.prototype.updateInputNames=function(){e.prototype.updateInputNames.call(this);d(this.textAreaSelector()).attr("name",this.getContentInputName())};f.prototype.init=function(){e.prototype.init.call(this)};f.prototype.bindEditor=function(){d(this.selector()).find(".editor-area").remove();var l=d(this.textAreaSelector());var k=parseInt(l.attr("rows"))*25;var m=d("<div>",{position:"absolute",width:"100%",height:k+"px","class":l.attr("class")+" editor-area"}).insertBefore(l);l.css("display","none");var o=ace.edit(m[0]);o.renderer.setShowGutter(false);o.getSession().setValue(l.val());o.getSession().setMode("ace/mode/"+this.mode);o.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:false,autoScrollEditorIntoView:true,animatedScroll:true,showInvisibles:false,fadeFoldWidgets:true,showFoldWidgets:true,showLineNumbers:true,showGutter:true,displayIndentGuides:true,fontSize:"14px",fontFamily:"mono",highlightActiveLine:false});o.setTheme("ace/theme/github");o.getSession().on("change",function(){l.val(o.getSession().getValue())});var n=this;d(this.elementChangeModeSelector()).next().find("li").unbind("click").click(function(p){p.preventDefault();var q=d(this).attr("data-mode");n.mode=q;l.attr("data-editor",q);d(n.selector()).find(".text-area-wrapper").attr("data-method",q);d(n.elementModeInputSelector()).val(q);o.getSession().setMode("ace/mode/"+q)});o.focus()};var g=function(l,k){e.apply(this,arguments);this.mode="banner"};g.prototype=Object.create(e.prototype);g.prototype.constructor=g;g.prototype.imageInputSelector=function(){return this.selector()+" #elements-"+this.setIdx+"-"+this.idx+"-image"};g.prototype.linkInputSelector=function(){return this.selector()+" #elements-"+this.setIdx+"-"+this.idx+"-link"};g.prototype.targetInputSelector=function(){return this.selector()+" #elements-"+this.setIdx+"-"+this.idx+"-target"};g.prototype.updateInputNames=function(l){e.prototype.updateInputNames.call(this);var k=this.getContentInputName();l.find(".input-image").attr("name",k+"[image]");l.find(".input-link").attr("name",k+"[link]");l.find(".input-target").attr("name",k+"[target]");l.find(".input-image").attr("id","elements-"+this.setIdx+"-"+this.idx+"-image");l.find(".input-link").attr("id","elements-"+this.setIdx+"-"+this.idx+"-link");l.find(".input-target").attr("id","elements-"+this.setIdx+"-"+this.idx+"-target")};g.prototype.unBindClickEvents=function(){e.prototype.unBindClickEvents.call(this);d(this.selector()).find(".input-media-btn").unbind("click")};g.prototype.bindClickEvent=function(k){k=k==undefined?false:k;e.prototype.bindClickEvent.call(this);if(!k){this.bindMediaGallery()}};g.prototype.bindMediaGallery=function(){d(this.selector()).find(".input-media-wrapper").each(function(){var k=d(this);var l=k.find(".media-input");k.find(".input-media-btn").unbind("click").click(function(){a.openFileFrame(l)})})};var i=function(l,k){e.apply(this,arguments);this.mode="post_category"};i.prototype=Object.create(e.prototype);i.prototype.constructor=i;var c=function(l,k){e.apply(this,arguments);this.mode="post_type"};c.prototype=Object.create(e.prototype);c.prototype.constructor=c;d(".form-group.element").each(function(l){var k=e.prototype.factory(d(this));k.bindClickEvent(true)});j.prototype.bindDeleteEvent()})(jQuery);