ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(ai,A,t){function j(){return typeof cvox!="undefined"&&cvox&&cvox.Api}function O(az){if(j()){i(az)}else{g++;if(g>=af){return}window.setTimeout(O,500,az)}}var y={};y.SpeechProperty,y.Cursor,y.Token,y.Annotation;var am={rate:0.8,pitch:0.4,volume:0.9},z={rate:1,pitch:0.5,volume:0.9},u={rate:0.8,pitch:0.8,volume:0.9},B={rate:0.8,pitch:0.3,volume:0.9},ad={rate:0.8,pitch:0.7,volume:0.9},aj={rate:0.8,pitch:0.8,volume:0.9},r={punctuationEcho:"none",relativePitch:-0.6},ag="ALERT_NONMODAL",al="ALERT_MODAL",v="INVALID_KEYPRESS",ah="insertMode",C="start",s=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],ak={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},G="CONTROL + SHIFT ";y.editor=null;var ae=null,E={},p=!1,R=!1,F=!1,T=null,ax={},n={},ao=function(az){return G+String.fromCharCode(az)},av=function(){var az=y.editor.keyBinding.getKeyboardHandler();return az.$id==="ace/keyboard/vim"},k=function(az){return y.editor.getSession().getTokenAt(az.row,az.column+1)},ay=function(az){return y.editor.getSession().getLine(az.row)},aw=function(az){E[az.row]&&cvox.Api.playEarcon(ag),p?(cvox.Api.stop(),W(az),Q(k(az)),ar(az.row,1)):ar(az.row,0)},ac=function(aC){var az=ay(aC),aB=az.substr(aC.column-1);aC.column===0&&(aB=" "+az);var aD=/^\W(\w+)/,aA=aD.exec(aB);return aA!==null},o={constant:{prop:am},entity:{prop:u},keyword:{prop:B},storage:{prop:ad},variable:{prop:aj},meta:{prop:z,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},a={prop:a},aq=function(aC,az){var aB=aC;for(var aD=0;aD<az.length;aD++){var aA=az[aD],aE=new RegExp(aA.substr,"g");aB=aB.replace(aE,aA.newSubstr)}return aB},l=function(aC,az,aB){var aD={};aD.value="",aD.type=aC[az].type;for(var aA=az;aA<aB;aA++){aD.value+=aC[aA].value}return aD},an=function(aC){if(aC.length<=1){return aC}var az=[],aB=0;for(var aD=1;aD<aC.length;aD++){var aA=aC[aB],aE=aC[aD];U(aA)!==U(aE)&&(az.push(l(aC,aB,aD)),aB=aD)}return az.push(l(aC,aB,aC.length)),az},q=function(az){var aA=y.editor.getSession().getLine(az),aB=/^\s*$/;return aB.exec(aA)!==null},ar=function(aC,az){var aB=y.editor.getSession().getTokens(aC);if(aB.length===0||q(aC)){cvox.Api.playEarcon("EDITABLE_TEXT");return}aB=an(aB);var aA=aB[0];aB=aB.filter(function(aD){return aD!==aA}),H(aA,az),aB.forEach(Q)},w=function(az){H(az,0)},Q=function(az){H(az,1)},U=function(aC){if(!aC||!aC.type){return}var aA=aC.type.split(".");if(aA.length===0){return}var aB=aA[0],az=o[aB];return az?az:a},H=function(aC,aA){var aB=U(aC),az=aq(aC.value,s);aB.replace&&(az=aq(az,aB.replace)),cvox.Api.speak(az,aA,aB.prop)},W=function(az){var aA=ay(az);cvox.Api.speak(aA[az.column],1)},X=function(aC,aA){var aB=ay(aA),az=aB.substring(aC.column,aA.column);az=az.replace(/ /g," space "),cvox.Api.speak(az)},V=function(az,aA){if(Math.abs(az.column-aA.column)!==1){var aB=ay(aA).length;if(aA.column===0||aA.column===aB){ar(aA.row,0);return}if(ac(aA)){cvox.Api.stop(),Q(k(aA));return}}W(aA)},f=function(az,aA){y.editor.selection.isEmpty()?R?X(az,aA):V(az,aA):(X(az,aA),cvox.Api.speak("selected",1))},at=function(az){if(F){F=!1;return}var aA=y.editor.selection.getCursor();aA.row!==ae.row?aw(aA):f(ae,aA),ae=aA},au=function(az){y.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},P=function(az){var aA=az.data;switch(aA.action){case"removeText":cvox.Api.speak(aA.text,0,r),F=!0;break;case"insertText":cvox.Api.speak(aA.text,0),F=!0}},ap=function(az){var aA=az.row,aB=az.column;return !E[aA]||!E[aA][aB]},Z=function(aC){E={};for(var az=0;az<aC.length;az++){var aB=aC[az],aD=aB.row,aA=aB.column;E[aD]||(E[aD]={}),E[aD][aA]=aB}},aa=function(az){var aA=y.editor.getSession().getAnnotations(),aB=aA.filter(ap);aB.length>0&&cvox.Api.playEarcon(ag),Z(aA)},b=function(az){var aA=az.type+" "+az.text+" on "+Y(az.row,az.column);aA=aA.replace(";","semicolon"),cvox.Api.speak(aA,1)},S=function(az){var aA=E[az];for(var aB in aA){b(aA[aB])}},Y=function(az,aA){return"row "+(az+1)+" column "+(aA+1)},c=function(){cvox.Api.speak(Y(ae.row,ae.column))},I=function(){for(var az in E){S(az)}},h=function(){if(!av()){return}switch(y.editor.keyBinding.$data.state){case ah:cvox.Api.speak("Insert mode");break;case C:cvox.Api.speak("Command mode")}},D=function(){p=!p,p?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},x=function(){R=!R,R?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},m=function(az){if(az.ctrlKey&&az.shiftKey){var aA=ax[az.keyCode];aA&&aA.func()}},e=function(az,aA){if(!av()){return}var aB=aA.keyBinding.$data.state;if(aB===T){return}switch(aB){case ah:cvox.Api.playEarcon(al),cvox.Api.setKeyEcho(!0);break;case C:cvox.Api.playEarcon(al),cvox.Api.setKeyEcho(!1)}T=aB},d=function(az){var aA=az.detail.customCommand,aB=n[aA];aB&&(aB.func(),y.editor.focus())},J=function(){var az=N.map(function(aB){return{desc:aB.desc+ao(aB.keyCode),cmd:aB.cmd}}),aA=document.querySelector("body");aA.setAttribute("contextMenuActions",JSON.stringify(az)),aA.addEventListener("ATCustomEvent",d,!0)},ab=function(az){az.match?ar(ae.row,0):cvox.Api.playEarcon(v)},L=function(){y.editor.focus()},N=[{keyCode:49,func:function(){S(ae.row)},cmd:ak.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:I,cmd:ak.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:h,cmd:ak.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:D,cmd:ak.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:c,cmd:ak.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:x,cmd:ak.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:L,cmd:ak.FOCUS_TEXT,desc:"Focus text"}],K=function(){y.editor=editor,editor.getSession().selection.on("changeCursor",at),editor.getSession().selection.on("changeSelection",au),editor.getSession().on("change",P),editor.getSession().on("changeAnnotation",aa),editor.on("changeStatus",e),editor.on("findSearchBox",ab),editor.container.addEventListener("keydown",m),ae=editor.selection.getCursor()},i=function(az){K(),N.forEach(function(aA){ax[aA.keyCode]=aA,n[aA.cmd]=aA}),az.on("focus",K),av()&&cvox.Api.setKeyEcho(!1),J()},g=0,af=15,M=ai("../editor").Editor;ai("../config").defineOptions(M.prototype,"editor",{enableChromevoxEnhancements:{set:function(az){az&&O(this)},value:!0}})});(function(){ace.require(["ace/ext/chromevox"],function(){})})();