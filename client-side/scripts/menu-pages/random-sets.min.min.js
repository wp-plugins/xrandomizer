(function(f){function d(b,c,h,a){this.elementSet=c.toString();this.elementSetId=h.toString();this.mode=a==undefined?"html":a.toString();this.oldElement={};this.oldElement.elementIndex=parseInt(b);this.oldElement.$wrapper=f("#element-row-"+c+"-"+this.oldElement.elementIndex.toString());this.oldElement.$wrapper.textAreaWrapper=this.oldElement.$wrapper.children(".text-area-wrapper");this.oldElement.$wrapper.textArea=this.oldElement.$wrapper.textAreaWrapper.children(".text-area");this.oldElement.$wrapper.elementControls=this.oldElement.$wrapper.children(".element-control");this.newElement={elementIndex:parseInt(b)+1,$wrapper:null}}d.prototype.addNewElementAfterOld=function(){this.formNewElement("");this.updateNextElements();this.addAfterOld();this.bindClickEvent();e.prototype.bindEditor(f(this.newElement.$wrapper.textArea))};d.prototype.formNewElement=function(a){this.newElement.$wrapper=f(this.oldElement.$wrapper[0].outerHTML);this.newElement.$wrapper.find(".ace_editor").remove();this.newElement.$wrapper.textAreaWrapper=this.newElement.$wrapper.children(".text-area-wrapper");this.newElement.$wrapper.textArea=this.newElement.$wrapper.textAreaWrapper.children(".text-area");this.newElement.$wrapper.elementControls=this.newElement.$wrapper.children(".element-control");this.newElement.$wrapper.attr("data-index",this.newElement.elementIndex);this.newElement.$wrapper.attr("id","element-row-"+this.elementSet+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textAreaWrapper.attr("data-method",this.mode);this.newElement.$wrapper.textArea.attr("id","elements-"+this.elementSetId+"-"+this.newElement.elementIndex);this.newElement.$wrapper.textArea.attr("name","rz[a][a][0]["+this.elementSetId+"][elements]["+this.newElement.elementIndex+"][content]");this.newElement.$wrapper.textArea.val(a);this.newElement.$wrapper.textArea.attr("data-editor",this.mode);this.newElement.$wrapper.elementControls.remove();this.newElement.$wrapper.append(this.getElementActionsMarkUp(this.elementSetId,this.elementSet,this.newElement.elementIndex,false,false))};d.prototype.addAfterOld=function(){this.newElement.$wrapper.hide();this.oldElement.$wrapper.after(this.newElement.$wrapper);this.newElement.$wrapper.slideDown("fast");this.newElement.$wrapper.textArea.focus()};d.prototype.bindClickEvent=function(){f(".element-add").next().find("li").unbind("click").click(function(c){c.preventDefault();var l=f(this).parent().attr("data-index");var m=f(this).parent().attr("data-set");var a=f(this).parent().attr("data-setid");var b=f(this).attr("data-mode");var k=new d(l,m,a,b);k.addNewElementAfterOld()});f(".element-add").next().find("li").find("a").unbind("click").click(function(a){a.preventDefault()});f(".element-delete").unbind("click").click(function(){var j=f(this).attr("data-index");var k=f(this).attr("data-set");var a=f(this).attr("data-setid");var l=f("#elements-"+a+"-"+j);if((l!=undefined&&l.val().length>0)||l==undefined){var b=confirm("Are you sure you want to delete this element?");if(b!=true){return b}}var c=new d(j,k,a);c.oldElement.$wrapper.slideUp("fast",function(){f(this).remove()})});f(".element-pin").unbind("click").click(function(){var b=f(this).attr("data-setid");var a=f(this).attr("data-index");if(f(this).hasClass("active")){f(this).removeClass("active").blur();f("#pined-"+b+"-"+a).val(0);f(this).children("i").removeClass("fa-lock");f(this).children("i").addClass("fa-unlock")}else{f(this).addClass("active").blur();f("#pined-"+b+"-"+a).val(1);f(this).children("i").removeClass("fa-unlock");f(this).children("i").addClass("fa-lock")}});f(".element-disable").unbind("click").click(function(){var b=f(this).attr("data-setid");var a=f(this).attr("data-index");if(f(this).hasClass("active")){f(this).removeClass("active").blur();f("#disabled-"+b+"-"+a).val(0)}else{f(this).addClass("active").blur();f("#disabled-"+b+"-"+a).val(1)}})};d.prototype.updateNextElements=function(){var a=this;this.oldElement.$wrapper.nextAll(".form-group").each(function(o){var c=a.newElement.elementIndex+o;var p=c+1;var l=f(this);l.textAreaWrapper=l.children(".text-area-wrapper");l.textArea=l.textAreaWrapper.children(".text-area");l.elementControls=l.children(".element-control");l.attr("data-index",p);l.attr("id","element-row-"+a.elementSet+"-"+p.toString());l.textArea.attr("id","elements-"+a.elementSetId+"-"+p.toString());l.textArea.attr("name","rz[a][a][0]["+a.elementSetId+"][elements]["+p+"][content]");var m=parseInt(f(this).find("input:regex(id, .*pined.*)").val())==1;var n=parseInt(f(this).find("input:regex(id, .*disabled.*)").val())==1;var b=f(this).find("input:regex(id, .*mode.*)").val();l.elementControls.remove();l.append(a.getElementActionsMarkUp(a.elementSetId,a.elementSet,p,m,n,b))})};d.prototype.getElementActionsMarkUp=function(x,v,c,w,s,q){w=w==undefined?false:w;s=s==undefined?false:s;q=q==undefined?this.mode:q;var r=w?" fa-lock ":" fa-unlock ";var b=w?" active ":"";var k=s?" active ":"";var a=' data-setid="'+x+'" data-set="'+v+'" data-index="'+c+'" ';var t='<div class="col-sm-2 text-center element-control">';t+='<div class="row b-margin-sm">';t+='<div class="col-sm-6">';t+='<button type="button"'+a+'style="font-size: 1em;" class="btn btn-success element-pin'+b+'" title="Pin element">';t+='<i class="fa '+r+'"></i></button>';t+="</div>";t+='<div class="col-sm-6 btn-group">';t+='<button type="button"'+a+'style="font-size: 1em; float: none;" class="btn btn-success element-add dropdown-toggle" title="Add new element"data-toggle="xd-v141226-dev-dropdown"><i class="fa fa-plus"></i></button><ul class="dropdown-menu" '+a+">";for(var u in e.prototype.elementModes){t+='<li data-mode="'+u+'"><a href="#">'+e.prototype.elementModes[u]+"</a></li>"}t+="</ul>";t+="</div>";t+="</div>";t+='<div class="row">';if(c!=0){t+='<div class="col-sm-6">';t+='<button type="button"'+a+'style="font-size: 1em;" class="btn btn-warning element-disable'+k+'" title="Disable element"><i class="fa fa-power-off"></i></button>';t+="</div>";t+='<div class="col-sm-6">';t+='<button type="button"'+a+'style="font-size: 1em;" class="btn btn-danger element-delete" title="Delete element"><i class="fa fa-trash-o"></i></button>';t+="</div>"}t+="</div>";t+='<input id="pined-'+x+"-"+c+'" class="pined" type="hidden" data-initial-value="" value="'+(w?"1":"0")+'" name="rz[a][a][0]['+x+"][elements]["+c+'][pined]"><input id="disabled-'+x+"-"+c+'" class="pined" type="hidden" data-initial-value="" value="'+(s?"1":"0")+'" name="rz[a][a][0]['+x+"][elements]["+c+'][disabled]"><input id="mode-'+x+"-"+c+'" class="mode" type="hidden" data-initial-value="" value="'+q+'" name="rz[a][a][0]['+x+"][elements]["+c+'][mode]">';t+="</div>";return t};function e(a,b){this.setIdx=a;this.$selector=b}e.prototype={sets:{0:true},bindDeleteEvent:function(){f(".set-delete").unbind("click").click(function(){var b=confirm("Are you sure you want to delete this set?");if(b!=true){return b}var a=parseInt(f(this).attr("data-setidx"));var h=f("#"+f(this).attr("data-setselector"));var c=new e(a,h);c.deleteSet()})},bindAddEvent:function(){f(".set-add").unbind("click").click(function(){var a=parseInt(f(this).attr("data-setidx"));var c=f("#"+f(this).attr("data-setselector"));var b=new e(a,c);b.addNewSet()})},bindEditor:function(k){var a=k.data("editor");var l=parseInt(k.attr("rows"))*25;var j=f("<div>",{position:"absolute",width:"100%",height:l+"px","class":k.attr("class")}).insertBefore(k);k.css("display","none");var c=ace.edit(j[0]);c.renderer.setShowGutter(false);c.getSession().setValue(k.val());c.getSession().setMode("ace/mode/"+a);c.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:false,autoScrollEditorIntoView:true,animatedScroll:true,showInvisibles:false,fadeFoldWidgets:true,showFoldWidgets:true,showLineNumbers:true,showGutter:true,displayIndentGuides:true,fontSize:"14px",fontFamily:"mono",highlightActiveLine:false});c.setTheme("ace/theme/github");c.getSession().on("change",function(){k.val(c.getSession().getValue())});var b=k.parent().parent();b.find(".element-change-method").next().find("li").unbind("click").click(function(h){var i=f(this).parent().attr("data-index");var o=f(this).parent().attr("data-set");var p=f(this).parent().attr("data-setid");h.preventDefault();var g=f(this).attr("data-mode");k.attr("data-editor",g);b.find(".text-area-wrapper").attr("data-method",g);b.find("#mode-"+p+"-"+i).val(g);c.getSession().setMode("ace/mode/"+g)});c.focus()},addNewSet:function(){e.prototype.bindAddEvent();e.prototype.bindDeleteEvent()},deleteSet:function(){this.$selector.remove();e.prototype.bindAddEvent();e.prototype.bindDeleteEvent()},getAnIdForNewSet:function(){return e.prototype.sets.length+1},setsStashId:function(a){a=parseInt(a);e.prototype.sets[a]=true}};e.prototype.bindAddEvent();e.prototype.bindDeleteEvent();d.prototype.bindClickEvent();ace.require("ace/ext/language_tools");f("textarea[data-editor]").each(function(){e.prototype.bindEditor(f(this))});e.prototype.elementModes=elementModes})(jQuery);